import { __rest } from "tslib";
import { FlashcardStatus } from './flashcard';
import { Quark } from './quark';
import { getProtonYaml } from './yaml';
import * as fs from 'fs';
export class Proton extends Quark {
    constructor(_a) {
        var { examples = '' } = _a, quarkProps = __rest(_a, ["examples"]);
        super(quarkProps);
        this.examples = examples;
    }
    imageTag() {
        return '';
    }
    generateProtonContent() {
        const flashcardSection = this.basicFlashcard.generateFlashcardSection('basic');
        const reverseFlashcardSection = this.reverseFlashcard.generateFlashcardSection('reverse');
        let imageTag = this.imageTag();
        let content = `${this.frontmatter()}${this.definition}---\n${this.examples}\n\n`;
        if (this.createFlashcard) {
            content = content + flashcardSection;
        }
        if (this.createReverseFlashcard) {
            content = content + '\n\n---\n\n' + reverseFlashcardSection;
        }
        return content;
    }
    frontmatter() {
        return `---\nname: ${this.name}\ntype: ${this.type}\ncreateFlashcard: ${this.createFlashcard}\ncreateReverseFlashcard: ${this.createReverseFlashcard}\n---`;
    }
    generateReverseFlashcardSection() {
        return `\n\n${this.reverseFlashcard.generateFlashcardSection('reverse')}`;
    }
    populateFromFile(fileName, fileContent) {
        const yamlData = getProtonYaml(fileContent);
        this.name = fileName.split('.')[0];
        this.type = (yamlData === null || yamlData === void 0 ? void 0 : yamlData.type) || '';
        this.createFlashcard = (yamlData === null || yamlData === void 0 ? void 0 : yamlData.createFlashcard) || false;
        this.createReverseFlashcard = (yamlData === null || yamlData === void 0 ? void 0 : yamlData.createReverseFlashcard) || false;
        const sections = fileContent.split("\n## ");
        this.definition = sections[0].split('---')[2] || '';
        if (fileContent.includes('#flashcard')) {
            this.examples = `## ${this.removeSuccessiveNewlines(sections[1].split('######')[0])}` || '';
        }
        else {
            this.examples = `## ${sections[1]}` || '';
        }
        const flashcardSection = sections[1];
        // Basic Flashcard
        this.flashcardInfo = flashcardSection.split('######')[1];
        if (this.flashcardInfo) {
            const flashcardDefinition = this.getDefinitionFromFlashcardContent(this.basicFlashcard.getFlashcardBack(this.flashcardInfo)).trim();
            if (flashcardDefinition == this.rawDefinition()) {
                this.basicFlashcard.status = FlashcardStatus.NO_CHANGE;
                this.basicFlashcard.populateFromExistingFlashcard('basic', this.name, this.flashcardInfo);
            }
            else {
                this.basicFlashcard.status = FlashcardStatus.CHANGE;
                this.basicFlashcard.populateNewFlashcard('basic', this.name, this.rawDefinition(), this.imageTag());
            }
        }
        else if (this.createFlashcard) {
            //console.log(`${this.name} does not have a basic flashcard`);
            this.basicFlashcard.status = FlashcardStatus.NEW;
            this.basicFlashcard.populateNewFlashcard('basic', this.name, this.rawDefinition(), this.imageTag(), false);
        }
        // Reverse Flashcard
        this.reverseFlashcardInfo = flashcardSection.split('---')[2];
        if (this.reverseFlashcardInfo) {
            if (!this.basicFlashcard.isDirty()) {
                this.reverseFlashcard.status = FlashcardStatus.NO_CHANGE;
                this.reverseFlashcard.populateFromExistingFlashcard('reverse', this.name, this.reverseFlashcardInfo);
            }
            else {
                this.reverseFlashcard.status = FlashcardStatus.CHANGE;
                this.reverseFlashcard.populateNewFlashcard('reverse', this.name, this.rawDefinition(), this.imageTag(), true);
            }
            this.reverseFlashcard.populateFromExistingFlashcard('reverse', this.name, this.reverseFlashcardInfo);
        }
        else if (this.createReverseFlashcard) {
            this.reverseFlashcard.status = FlashcardStatus.NEW;
            this.reverseFlashcard.populateNewFlashcard('reverse', this.name, this.rawDefinition(), this.imageTag(), false);
        }
    }
    writeToFile(filePath) {
        // If we have new flashcards or changed Atom data, we need to write to file
        if (this.basicFlashcard.isDirty() || this.reverseFlashcard.isDirty()) {
            // write to file
            console.log(`Updated ${this.name} with new Atom content`);
            const protonContent = this.generateProtonContent();
            fs.writeFileSync(filePath, protonContent);
        }
    }
    getDefinitionFromFlashcardContent(flashcardContent) {
        return flashcardContent.split('##')[0] || '';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdG9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2F0b20vcHJvdG9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQWEsZUFBZSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3pELE9BQU8sRUFBeUIsS0FBSyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ3ZELE9BQU8sRUFBZSxhQUFhLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDcEQsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFNekIsTUFBTSxPQUFPLE1BQU8sU0FBUSxLQUFLO0lBRzdCLFlBQVksRUFHYTtZQUhiLEVBQ1IsUUFBUSxHQUFHLEVBQUUsT0FFUSxFQURsQixVQUFVLGNBRkwsWUFHWCxDQURnQjtRQUViLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztJQUM3QixDQUFDO0lBQ0QsUUFBUTtRQUNKLE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELHFCQUFxQjtRQUNqQixNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDL0UsTUFBTSx1QkFBdUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsd0JBQXdCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDMUYsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQzlCLElBQUksT0FBTyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLFFBQVEsSUFBSSxDQUFDLFFBQVEsTUFBTSxDQUFDO1FBQ2pGLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN0QixPQUFPLEdBQUcsT0FBTyxHQUFHLGdCQUFnQixDQUFDO1NBQ3hDO1FBQ0QsSUFBSSxJQUFJLENBQUMsc0JBQXNCLEVBQUU7WUFDN0Is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Q0FBQztTQUN4RzthQUNJLElBQUksSUFBSSxDQUFDLHNCQUFzQixFQUFFO1lBQ2xDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEdBQUcsZUFBZSxDQUFDLEdBQUcsQ0FBQTtZQUNsRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNsSDtJQUNMLENBQUM7SUFFRCxXQUFXLENBQUMsUUFBZ0I7UUFDeEIsMkVBQTJFO1FBQzNFLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDbEUsZ0JBQWdCO1lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLENBQUMsSUFBSSx3QkFBd0IsQ0FBQyxDQUFDO1lBQzFELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQ25ELEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQzdDO0lBQ0wsQ0FBQztJQUVELGlDQUFpQyxDQUFDLGdCQUF3QjtRQUN0RCxPQUFPLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDakQsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmxhc2hjYXJkLCBGbGFzaGNhcmRTdGF0dXMgfSBmcm9tICcuL2ZsYXNoY2FyZCc7XG5pbXBvcnQgeyBRdWFya0NvbnN0cnVjdG9yUHJvcHMsIFF1YXJrIH0gZnJvbSAnLi9xdWFyayc7XG5pbXBvcnQgeyBnZXRBdG9tWWFtbCwgZ2V0UHJvdG9uWWFtbCB9IGZyb20gJy4veWFtbCc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5cbmludGVyZmFjZSBQcm90b25Db25zdHJ1Y3RvclByb3BzIGV4dGVuZHMgUXVhcmtDb25zdHJ1Y3RvclByb3Bze1xuICAgIGV4YW1wbGVzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBjbGFzcyBQcm90b24gZXh0ZW5kcyBRdWFyayB7XG4gICAgZXhhbXBsZXM6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHtcbiAgICAgICAgZXhhbXBsZXMgPSAnJyxcbiAgICAgICAgLi4ucXVhcmtQcm9wc1xuICAgIH06IFByb3RvbkNvbnN0cnVjdG9yUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocXVhcmtQcm9wcyk7XG4gICAgICAgIHRoaXMuZXhhbXBsZXMgPSBleGFtcGxlcztcbiAgICB9XG4gICAgaW1hZ2VUYWcoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIGdlbmVyYXRlUHJvdG9uQ29udGVudCgpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBmbGFzaGNhcmRTZWN0aW9uID0gdGhpcy5iYXNpY0ZsYXNoY2FyZC5nZW5lcmF0ZUZsYXNoY2FyZFNlY3Rpb24oJ2Jhc2ljJyk7XG4gICAgICAgIGNvbnN0IHJldmVyc2VGbGFzaGNhcmRTZWN0aW9uID0gdGhpcy5yZXZlcnNlRmxhc2hjYXJkLmdlbmVyYXRlRmxhc2hjYXJkU2VjdGlvbigncmV2ZXJzZScpO1xuICAgICAgICBsZXQgaW1hZ2VUYWcgPSB0aGlzLmltYWdlVGFnKClcbiAgICAgICAgbGV0IGNvbnRlbnQgPSBgJHt0aGlzLmZyb250bWF0dGVyKCl9JHt0aGlzLmRlZmluaXRpb259LS0tXFxuJHt0aGlzLmV4YW1wbGVzfVxcblxcbmA7XG4gICAgICAgIGlmICh0aGlzLmNyZWF0ZUZsYXNoY2FyZCkge1xuICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQgKyBmbGFzaGNhcmRTZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNyZWF0ZVJldmVyc2VGbGFzaGNhcmQpIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50ICsgJ1xcblxcbi0tLVxcblxcbicgKyByZXZlcnNlRmxhc2hjYXJkU2VjdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb250ZW50O1xuICAgIH1cblxuICAgIGZyb250bWF0dGVyKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgLS0tXFxubmFtZTogJHt0aGlzLm5hbWV9XFxudHlwZTogJHt0aGlzLnR5cGV9XFxuY3JlYXRlRmxhc2hjYXJkOiAke3RoaXMuY3JlYXRlRmxhc2hjYXJkfVxcbmNyZWF0ZVJldmVyc2VGbGFzaGNhcmQ6ICR7dGhpcy5jcmVhdGVSZXZlcnNlRmxhc2hjYXJkfVxcbi0tLWA7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVSZXZlcnNlRmxhc2hjYXJkU2VjdGlvbigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gYFxcblxcbiR7dGhpcy5yZXZlcnNlRmxhc2hjYXJkLmdlbmVyYXRlRmxhc2hjYXJkU2VjdGlvbigncmV2ZXJzZScpfWBcbiAgICB9XG5cbiAgICBwb3B1bGF0ZUZyb21GaWxlKGZpbGVOYW1lOiBzdHJpbmcsIGZpbGVDb250ZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeWFtbERhdGEgPSBnZXRQcm90b25ZYW1sKGZpbGVDb250ZW50KTtcbiAgICAgICAgdGhpcy5uYW1lID0gZmlsZU5hbWUuc3BsaXQoJy4nKVswXTtcbiAgICAgICAgdGhpcy50eXBlID0geWFtbERhdGE/LnR5cGUgfHwgJyc7XG5cbiAgICAgICAgdGhpcy5jcmVhdGVGbGFzaGNhcmQgPSB5YW1sRGF0YT8uY3JlYXRlRmxhc2hjYXJkIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmNyZWF0ZVJldmVyc2VGbGFzaGNhcmQgPSB5YW1sRGF0YT8uY3JlYXRlUmV2ZXJzZUZsYXNoY2FyZCB8fCBmYWxzZTtcblxuICAgICAgICBjb25zdCBzZWN0aW9ucyA9IGZpbGVDb250ZW50LnNwbGl0KFwiXFxuIyMgXCIpO1xuICAgICAgICB0aGlzLmRlZmluaXRpb24gPSBzZWN0aW9uc1swXS5zcGxpdCgnLS0tJylbMl0gfHwgJyc7XG4gICAgICAgIGlmIChmaWxlQ29udGVudC5pbmNsdWRlcygnI2ZsYXNoY2FyZCcpKSB7XG4gICAgICAgICAgICB0aGlzLmV4YW1wbGVzID0gYCMjICR7dGhpcy5yZW1vdmVTdWNjZXNzaXZlTmV3bGluZXMoc2VjdGlvbnNbMV0uc3BsaXQoJyMjIyMjIycpWzBdKX1gIHx8ICcnOyAgICBcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXhhbXBsZXMgPSBgIyMgJHtzZWN0aW9uc1sxXX1gIHx8ICcnO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmbGFzaGNhcmRTZWN0aW9uID0gc2VjdGlvbnNbMV1cbiAgICAgICAgXG4gICAgICAgLy8gQmFzaWMgRmxhc2hjYXJkXG4gICAgICAgIHRoaXMuZmxhc2hjYXJkSW5mbyA9IGZsYXNoY2FyZFNlY3Rpb24uc3BsaXQoJyMjIyMjIycpWzFdXG4gICAgICAgIGlmICh0aGlzLmZsYXNoY2FyZEluZm8pIHtcbiAgICAgICAgICAgIGNvbnN0IGZsYXNoY2FyZERlZmluaXRpb24gPSB0aGlzLmdldERlZmluaXRpb25Gcm9tRmxhc2hjYXJkQ29udGVudCh0aGlzLmJhc2ljRmxhc2hjYXJkLmdldEZsYXNoY2FyZEJhY2sodGhpcy5mbGFzaGNhcmRJbmZvKSkudHJpbSgpO1xuICAgICAgICAgICAgaWYgKGZsYXNoY2FyZERlZmluaXRpb24gPT0gdGhpcy5yYXdEZWZpbml0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJhc2ljRmxhc2hjYXJkLnN0YXR1cyA9IEZsYXNoY2FyZFN0YXR1cy5OT19DSEFOR0U7XG4gICAgICAgICAgICAgICAgdGhpcy5iYXNpY0ZsYXNoY2FyZC5wb3B1bGF0ZUZyb21FeGlzdGluZ0ZsYXNoY2FyZCgnYmFzaWMnLCB0aGlzLm5hbWUsIHRoaXMuZmxhc2hjYXJkSW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJhc2ljRmxhc2hjYXJkLnN0YXR1cyA9IEZsYXNoY2FyZFN0YXR1cy5DSEFOR0U7XG4gICAgICAgICAgICAgICAgdGhpcy5iYXNpY0ZsYXNoY2FyZC5wb3B1bGF0ZU5ld0ZsYXNoY2FyZCgnYmFzaWMnLCB0aGlzLm5hbWUsIHRoaXMucmF3RGVmaW5pdGlvbigpLCB0aGlzLmltYWdlVGFnKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5jcmVhdGVGbGFzaGNhcmQpIHtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfSBkb2VzIG5vdCBoYXZlIGEgYmFzaWMgZmxhc2hjYXJkYCk7XG4gICAgICAgICAgICB0aGlzLmJhc2ljRmxhc2hjYXJkLnN0YXR1cyA9IEZsYXNoY2FyZFN0YXR1cy5ORVdcbiAgICAgICAgICAgIHRoaXMuYmFzaWNGbGFzaGNhcmQucG9wdWxhdGVOZXdGbGFzaGNhcmQoJ2Jhc2ljJywgdGhpcy5uYW1lLCB0aGlzLnJhd0RlZmluaXRpb24oKSwgdGhpcy5pbWFnZVRhZygpLCBmYWxzZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXZlcnNlIEZsYXNoY2FyZFxuICAgICAgICB0aGlzLnJldmVyc2VGbGFzaGNhcmRJbmZvID0gZmxhc2hjYXJkU2VjdGlvbi5zcGxpdCgnLS0tJylbMl07XG4gICAgICAgIGlmICh0aGlzLnJldmVyc2VGbGFzaGNhcmRJbmZvKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYmFzaWNGbGFzaGNhcmQuaXNEaXJ0eSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXZlcnNlRmxhc2hjYXJkLnN0YXR1cyA9IEZsYXNoY2FyZFN0YXR1cy5OT19DSEFOR0U7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXZlcnNlRmxhc2hjYXJkLnBvcHVsYXRlRnJvbUV4aXN0aW5nRmxhc2hjYXJkKCdyZXZlcnNlJywgdGhpcy5uYW1lLCB0aGlzLnJldmVyc2VGbGFzaGNhcmRJbmZvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmV2ZXJzZUZsYXNoY2FyZC5zdGF0dXMgPSBGbGFzaGNhcmRTdGF0dXMuQ0hBTkdFO1xuICAgICAgICAgICAgICAgIHRoaXMucmV2ZXJzZUZsYXNoY2FyZC5wb3B1bGF0ZU5ld0ZsYXNoY2FyZCgncmV2ZXJzZScsIHRoaXMubmFtZSwgdGhpcy5yYXdEZWZpbml0aW9uKCksIHRoaXMuaW1hZ2VUYWcoKSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJldmVyc2VGbGFzaGNhcmQucG9wdWxhdGVGcm9tRXhpc3RpbmdGbGFzaGNhcmQoJ3JldmVyc2UnLCB0aGlzLm5hbWUsIHRoaXMucmV2ZXJzZUZsYXNoY2FyZEluZm8pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY3JlYXRlUmV2ZXJzZUZsYXNoY2FyZCkge1xuICAgICAgICAgICAgdGhpcy5yZXZlcnNlRmxhc2hjYXJkLnN0YXR1cyA9IEZsYXNoY2FyZFN0YXR1cy5ORVdcbiAgICAgICAgICAgIHRoaXMucmV2ZXJzZUZsYXNoY2FyZC5wb3B1bGF0ZU5ld0ZsYXNoY2FyZCgncmV2ZXJzZScsIHRoaXMubmFtZSwgdGhpcy5yYXdEZWZpbml0aW9uKCksIHRoaXMuaW1hZ2VUYWcoKSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgd3JpdGVUb0ZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICAvLyBJZiB3ZSBoYXZlIG5ldyBmbGFzaGNhcmRzIG9yIGNoYW5nZWQgQXRvbSBkYXRhLCB3ZSBuZWVkIHRvIHdyaXRlIHRvIGZpbGVcbiAgICAgICAgaWYgKHRoaXMuYmFzaWNGbGFzaGNhcmQuaXNEaXJ0eSgpIHx8IHRoaXMucmV2ZXJzZUZsYXNoY2FyZC5pc0RpcnR5KCkpIHtcbiAgICAgICAgICAgIC8vIHdyaXRlIHRvIGZpbGVcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVcGRhdGVkICR7dGhpcy5uYW1lfSB3aXRoIG5ldyBBdG9tIGNvbnRlbnRgKTtcbiAgICAgICAgICAgIGNvbnN0IHByb3RvbkNvbnRlbnQgPSB0aGlzLmdlbmVyYXRlUHJvdG9uQ29udGVudCgpO1xuICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgcHJvdG9uQ29udGVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXREZWZpbml0aW9uRnJvbUZsYXNoY2FyZENvbnRlbnQoZmxhc2hjYXJkQ29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGZsYXNoY2FyZENvbnRlbnQuc3BsaXQoJyMjJylbMF0gfHwgJyc7XG4gICAgfVxufVxuIl19